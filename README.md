Ao alterar a ordem no loop de j e k. Fazemos um acesso em linha, utilizando os dados cachados. Ao contrário do outro caso que faz acessos em coluna.

Objetivos:

- Avaliar performance ao alterar a ordem do loop
- Calcular tempo de execução: t=2\*n^3 / Capacidade (Gflops)
- 2\*n^3 -> Complexidade do problema
- PAPI -> Permite obter contadores do sistema (e.g detetar falhas de cache)

Matrix Structure
A: [
[1,1,1],
[1,1,1],
[1,1,1]
]

B: [
[1,1,1],
[2,2,2],
[3,3,3]
]

C: [
[6,6,6],
[6,6,6],
[6,6,6]
]

DCM -> Data Cache Misses

### 1 - Processing Time

#### C++

| Matrix Size | Time (s) | GFlops | DCM1        | DCM2        | DCH2        | DCM2(%) |
| ----------- | -------- | ------ | ----------- | ----------- | ----------- | ------- |
| 600x600     | 0.223    | 1.937  | 47965166   | 7915044     | 238833002   | 3.21    |
| 1000x1000   | 1.474    | 1.357  | 503381563  | 76969658   | 1061103479  | 6.76   |
| 1400x1400   | 6.263    | 0.876  | 1031752086  | 352133818  | 2747871324  | 11.36   |
| 1800x1800   | 25.860   | 0.451  | 882346201  | 780837346  | 5808340864  | 11.85   |
| 2200x2200   | 59.384   | 0.359  | 1276286330 | 1537694373 | 10507321345 | 12.77   |
| 2600x2600   | 99.954   | 0.352  | 1968155030 | 3226483656 | 16766181399 | 16.14   |
| 3000x3000   | 161.460  | 0.334  | 4299317173 | 8111919195 | 23242070966 | 25.87   |

#### Java

| Matrix Size | Time (s) | GFlops |
| ----------- | -------- | ------ |
| 600x600     | 0.878    | 0,492  |
| 1000x1000   | 4.167    | 0,480  |
| 1400x1400   | 16.183   | 0,339  |
| 1800x1800   | 36.078   | 0,323  |
| 2200x2200   | 70.971   | 0,300  |
| 2600x2600   | 126.327  | 0,278  |
| 3000x3000   | 191.421  | 0,282  |

### 2 - Processing Time

#### C++

| Matrix Size | Time (s) | GFlops | DCM1       | DCM2       | DCH2      | DCM2(%) |
| ----------- | -------- | ------ | ---------- | ---------- | --------- | ------- |
| 600x600     | 0.100    | 4.320  | 286796   | 597491   | 25621827   | 2.28   |
| 1000x1000   | 0.634    | 3.155  | 1760833  | 3521665  | 79474344   | 4.24   |
| 1400x1400   | 1.765    | 2.109  | 4922082  | 9651142  | 207070103  | 4.54   |
| 1800x1800   | 3.918    | 2.977  | 11130866  | 20612714 | 444836992  | 4.43  |
| 2200x2200   | 9.090    | 2.996  | 19381091 | 24226364 | 1509393472 | 1.54   |
| 2600x2600   | 11.591   | 3.032  | 40222447 | 39824205 | 3505284114 | 1.12   |
| 3000x3000   | 24.264   | 3.054  | 62074365 | 61459767 | 5411154262 | 1.12   |

#### Java

| Matrix Size | Time (s) | GFlops |
| ----------- | -------- | ------ |
| 600x600     | 0.212    | 2,038  |
| 1000x1000   | 1.230    | 1,626  |
| 1400x1400   | 3.334    | 1,646  |
| 1800x1800   | 7.104    | 1,642  |
| 2200x2200   | 8.763    | 2,430  |
| 2600x2600   | 15.660   | 2,245  |
| 3000x3000   | 23.102   | 2,337  |

### 3 - Processing Time (Block Matrix)

#### C++

**Block Size 128**
| Matrix Size | Time (s) | GFlops | DCM1       | DCM2       | DCH2      | DCM2(%) |
| ----------- | -------- | ------ | ---------- | ---------- | --------- | ------- |
| 4096x4096 | 33.435 | 4.110 | 1498905128 | 4788834276 | 6464354587 | 42.56 |
| 6144x6144 | 99.179 | 4.677 | 2715124754 | 8758466947 | 30056258949 | 22.56 |
| 8192x8192 | 267.490 | 4.110 | 9735629596 | 31405256761 | 59120213902 | 34.69 |
| 10240x10240 | 487.566 | 4.404 | 22103581644 | 69073692638 | 105467801014 | 39.57 |

---

**Block Size 256**
| Matrix Size | Time (s) | GFlops | DCM1       | DCM2       | DCH2      | DCM2(%) |
| ----------- | -------- | ------ | ---------- | ---------- | --------- | ------- |
| 4096x4096 | 27.124 | 5.067 | 953662498 | 2384156244 | 7530893028 | 24.05 |
| 6144x6144 | 144.712 | 3.205 | 3524470964 | 8811177410 | 22425485730 | 28.208 |
| 8192x8192 | 467.726 | 2.351 | 10023014374 | 23864319938 | 32900534165 | 42.04 |
| 10240x10240 | 530.264 | 4.050 | 16024370227 | 39083829821 | 109240769865 | 26.35 |

---

**Block Size 512**
| Matrix Size | Time (s) | GFlops | DCM1       | DCM2       | DCH2      | DCM2(%) |
| ----------- | -------- | ------ | ---------- | ---------- | --------- | ------- |
| 4096x4096 | 41.296 | 3.328 | 632787617 | 1346356633 | 6789839416 | 16.55 |
| 6144x6144 | 162.378 | 2.857 | 1741446907 | 3705206186 | 14803000278 | 20.01 |
| 8192x8192 | 381.558 | 2.882 | 4829854449 | 10499683584 | 37587241348 | 21.83 |
| 10240x10240 | 688.802 | 3.112 | 7889107870 | 16785335893 | 89461344299 | 31.18 |

---

### Observations

DCM2 values are derived instead of directly measured

To reach a conclusion:

- Analyse with PAPI the level 1 and level2 DCA (data cache accesses, for example)
- papi_avail -a -> show papi registers

### Setup

`sudo sh -c 'echo -1 >/proc/sys/kernel/perf_event_paranoid'`
